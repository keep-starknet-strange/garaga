<div align="center">
  <h1>Garaga</h1>
  <img src="docs/images/logo.png" height="200">
  <br />
  <a href="https://github.com/keep-starknet-strange/garaga/issues/new?assignees=&labels=bug&template=01_BUG_REPORT.md&title=bug%3A+">Report a Bug</a>
  -
  <a href="https://github.com/keep-starknet-strange/garaga/issues/new?assignees=&labels=enhancement&template=02_FEATURE_REQUEST.md&title=feat%3A+">Request a Feature</a>
  -
  <a href="https://github.com/keep-starknet-strange/garaga/discussions">Ask a Question</a>
</div>

<div align="center">
<br />

[![GitHub Workflow Status](https://github.com/keep-starknet-strange/garaga/actions/workflows/test.yml/badge.svg)](https://github.com/keep-starknet-strange/garaga/actions/workflows/test.yml)
[![Project license](https://img.shields.io/github/license/keep-starknet-strange/garaga.svg?style=flat-square)](LICENSE)
[![Pull Requests welcome](https://img.shields.io/badge/PRs-welcome-ff69b4.svg?style=flat-square)](https://github.com/keep-starknet-strange/garaga/issues?q=is%3Aissue+is%3Aopen+label%3A%22help+wanted%22)

[![Exploration_Team](https://img.shields.io/badge/Exploration_Team-29296E.svg?&style=for-the-badge&logo=data:image/svg%2bxml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c3ZnIGlkPSJhIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODEgMTgxIj48ZGVmcz48c3R5bGU+LmJ7ZmlsbDojZmZmO308L3N0eWxlPjwvZGVmcz48cGF0aCBjbGFzcz0iYiIgZD0iTTE3Ni43Niw4OC4xOGwtMzYtMzcuNDNjLTEuMzMtMS40OC0zLjQxLTIuMDQtNS4zMS0xLjQybC0xMC42MiwyLjk4LTEyLjk1LDMuNjNoLjc4YzUuMTQtNC41Nyw5LjktOS41NSwxNC4yNS0xNC44OSwxLjY4LTEuNjgsMS44MS0yLjcyLDAtNC4yN0w5Mi40NSwuNzZxLTEuOTQtMS4wNC00LjAxLC4xM2MtMTIuMDQsMTIuNDMtMjMuODMsMjQuNzQtMzYsMzcuNjktMS4yLDEuNDUtMS41LDMuNDQtLjc4LDUuMThsNC4yNywxNi41OGMwLDIuNzIsMS40Miw1LjU3LDIuMDcsOC4yOS00LjczLTUuNjEtOS43NC0xMC45Ny0xNS4wMi0xNi4wNi0xLjY4LTEuODEtMi41OS0xLjgxLTQuNCwwTDQuMzksODguMDVjLTEuNjgsMi4zMy0xLjgxLDIuMzMsMCw0LjUzbDM1Ljg3LDM3LjNjMS4zNiwxLjUzLDMuNSwyLjEsNS40NCwxLjQybDExLjQtMy4xMSwxMi45NS0zLjYzdi45MWMtNS4yOSw0LjE3LTEwLjIyLDguNzYtMTQuNzYsMTMuNzNxLTMuNjMsMi45OC0uNzgsNS4zMWwzMy40MSwzNC44NGMyLjIsMi4yLDIuOTgsMi4yLDUuMTgsMGwzNS40OC0zNy4xN2MxLjU5LTEuMzgsMi4xNi0zLjYsMS40Mi01LjU3LTEuNjgtNi4wOS0zLjI0LTEyLjMtNC43OS0xOC4zOS0uNzQtMi4yNy0xLjIyLTQuNjItMS40Mi02Ljk5LDQuMyw1LjkzLDkuMDcsMTEuNTIsMTQuMjUsMTYuNzEsMS42OCwxLjY4LDIuNzIsMS42OCw0LjQsMGwzNC4zMi0zNS43NHExLjU1LTEuODEsMC00LjAxWm0tNzIuMjYsMTUuMTVjLTMuMTEtLjc4LTYuMDktMS41NS05LjE5LTIuNTktMS43OC0uMzQtMy42MSwuMy00Ljc5LDEuNjhsLTEyLjk1LDEzLjg2Yy0uNzYsLjg1LTEuNDUsMS43Ni0yLjA3LDIuNzJoLS42NWMxLjMtNS4zMSwyLjcyLTEwLjYyLDQuMDEtMTUuOGwxLjY4LTYuNzNjLjg0LTIuMTgsLjE1LTQuNjUtMS42OC02LjA5bC0xMi45NS0xNC4xMmMtLjY0LS40NS0xLjE0LTEuMDgtMS40Mi0xLjgxbDE5LjA0LDUuMTgsMi41OSwuNzhjMi4wNCwuNzYsNC4zMywuMTQsNS43LTEuNTVsMTIuOTUtMTQuMzhzLjc4LTEuMDQsMS42OC0xLjE3Yy0xLjgxLDYuNi0yLjk4LDE0LjEyLTUuNDQsMjAuNDYtMS4wOCwyLjk2LS4wOCw2LjI4LDIuNDYsOC4xNiw0LjI3LDQuMTQsOC4yOSw4LjU1LDEyLjk1LDEyLjk1LDAsMCwxLjMsLjkxLDEuNDIsMi4wN2wtMTMuMzQtMy42M1oiLz48L3N2Zz4=)](https://github.com/keep-starknet-strange)
</div>


</details>

## About

> State-of-the-art Elliptic Curve tooling and SNARKS verification for Cairo & Starknet üê∫.

Garaga can enable efficient elliptic curve pairing and scalar multiplication operations on Starknet.
It achieves state of the art performance by 
-  using a dedicated builtin made by Starkware for emulated modular arithmetic
- using a suite of non-deterministic techniques for extension field multiplication, pairings, and multi scalar multiplication to reduce the number of steps to verifiy results.

This is a work in progress, and is not yet ready for production use.

Here are some interesting use cases enabled by Garaga:
- SNARKs on StarkNet: Groth16 and Plonk (in the near future).
- KZG cryptographic commitment scheme.
- Identity-based encryption schemes.
- Attribute-based encryption schemes.
- BLS (Boneh‚ÄìLynn‚ÄìShacham) Digital Signature scheme. 


## Architecture overview (in progress.)



Garaga consists of a Pythonic backend and CairoZero / Starknet interfaces. 
- The Pythonic backend is here to define emulated modular arithmetic circuits that can be compiled to Cairo or Cairo1 code. 
    It also handles witnesses generation for the non-deterministic computations.
- The CairoZero / Starknet interfaces are responsible for composing and calling the circuits, as well as adding all the extra logic needed to make the algorithms work (Fiat-Shamir heuristic, SNARKS verifiers, etc). 


## Getting Started

To get started with Garaga, you'll need to have some tools and dependencies installed. Here's everything you need:

### Prerequisites

Ensure you have the following installed:
- [Python 3.10](https://www.python.org/downloads/) - The core language used for development.
- [Go](https://golang.org/doc/install) - Required for profiling and testing.
- [pprof](https://github.com/google/pprof) - A tool for visualization and analysis of profiling data.
- [graphviz](https://graphviz.org/download/) - Necessary for generating graphical representations of profiling data.
- A functional [SageMath](https://www.sagemath.org/download.html) installation or an operational [Docker](https://www.docker.com/get-started/) daemon with non-sudo privileges.

If you're using SageMath directly, make sure the edit the default parameter `use_docker` to `False` in the `EcipCLI` class inside `tools/ecip_cli.py`

### Setup

Once you have the prerequisites installed, clone the repository, and set up your development environment with the following command. Be sure to run this command from the root of the repository.


```bash
make setup
```

At this point, you should have everything you need to start developing with Garaga. Before proceeding, make sure to activate the virtual environment by running `source venv/bin/activate`.
### Compile & Run .cairo files (interactive script!) 

```bash
make run
```

## Benchmarks



| OP                 |   Weight in steps |
|--------------------|-------------------|
| MULMOD             |                 8 |
| ADDMOD             |                 4 |
| ASSERT_EQ          |                 2 |
| RLC                |                28 |
| POSEIDON BN254     |                14 |
| POSEIDON BLS12_381 |                17 |


| circuit                                   |   MULMOD |   ADDMOD |   ASSERT_EQ |   POSEIDON |   RLC |   ~steps |
|-------------------------------------------|----------|----------|-------------|------------|-------|----------|
| Derive Point From X                       |        6 |        2 |           0 |          0 |     0 |       56 |
| Double Step BLS12_381                     |       24 |       26 |           2 |          0 |     0 |      300 |
| Double Step BN254                         |       26 |       26 |           2 |          0 |     0 |      316 |
| Fp6 SQUARE_TORUS                          |       12 |       22 |           0 |          7 |     1 |      324 |
| Mul L by L                                |       18 |        8 |           0 |         11 |     1 |      380 |
| Double-and-Add Step BLS12_381             |       34 |       47 |           4 |          0 |     0 |      468 |
| Fp12 SQUARE                               |       25 |       11 |           0 |         13 |     1 |      480 |
| Triple Step                               |       38 |       43 |           4 |          0 |     0 |      484 |
| Mul LL by L                               |       26 |       13 |           0 |         13 |     1 |      496 |
| Double-and-Add Step BN254                 |       38 |       47 |           4 |          0 |     0 |      500 |
| Mul by L                                  |       28 |       15 |           0 |         13 |     1 |      520 |
| Mul LL by LL                              |       32 |       18 |           0 |         13 |     1 |      564 |
| Mul by LL                                 |       34 |       20 |           0 |         13 |     1 |      588 |
| Fp12 MUL                                  |       36 |       22 |           0 |         13 |     1 |      612 |
| Fp6 MUL_TORUS                             |       36 |       34 |           0 |         13 |     2 |      688 |
| MSM 1 points                              |      159 |      130 |           0 |         52 |     0 |     2624 |
| MSM 2 points                              |      203 |      168 |           0 |         64 |     0 |     3320 |
| MSM 3 points                              |      247 |      206 |           0 |         76 |     0 |     4016 |
| MSM 10 points                             |      555 |      472 |           0 |        160 |     0 |     8888 |
| MSM 50 points                             |     2315 |     1992 |           0 |        640 |     0 |    36728 |
| Miller n=1 BLS12_381                      |     4936 |     4966 |         137 |       1580 |   131 |    90154 |
| Miller n=1 BN254                          |     5984 |     5927 |         177 |       1810 |   153 |   101558 |
| Final Exp BN254                           |     4686 |     7223 |           3 |       1931 |   317 |   102296 |
| Final Exp BLS12_381                       |     5128 |     9061 |           3 |       2333 |   384 |   127687 |
| Miller n=2 BLS12_381                      |     8030 |     8171 |         273 |       2276 |   199 |   141734 |
| Miller n=2 BN254                          |    10132 |    10107 |         353 |       2740 |   241 |   167298 |
| Miller n=3 BLS12_381                      |    11356 |    11608 |         409 |       3088 |   267 |   198070 |
| MultiPairing n=1 BN254                    |    10670 |    13150 |         180 |       3741 |   470 |   203854 |
| MultiPairing n=1 BLS12_381                |    10064 |    14027 |         140 |       3913 |   515 |   217841 |
| BLS12FinalExp Fp12 Karabina No EXTF Trick |     7774 |    43002 |           0 |          0 |     0 |   234200 |
| Miller n=3 BN254                          |    14456 |    14463 |         529 |       3758 |   329 |   236382 |
| MultiPairing n=2 BLS12_381                |    13158 |    17232 |         276 |       4609 |   583 |   269421 |
| MultiPairing n=2 BN254                    |    14818 |    17330 |         356 |       4671 |   558 |   269594 |
| MultiPairing n=3 BLS12_381                |    16484 |    20669 |         412 |       5421 |   651 |   325757 |
| MultiPairing n=3 BN254                    |    19142 |    21686 |         532 |       5689 |   646 |   338678 |


|                     |   Final Exp BN254 |   Final Exp BLS12_381 |   Miller n=1 BLS12_381 |   Miller n=1 BN254 |   Miller n=2 BLS12_381 |   Miller n=2 BN254 |   Miller n=3 BLS12_381 |   Miller n=3 BN254 |
|---------------------|-------------------|-----------------------|------------------------|--------------------|------------------------|--------------------|------------------------|--------------------|
| EXTF_SQUARE         |                 0 |                     0 |                     63 |                 65 |                     63 |                 65 |                     63 |                 65 |
| EXTF_MUL_DENSE      |                62 |                    33 |                      0 |                  0 |                      5 |                 22 |                     63 |                 66 |
| MUL_TORUS           |                62 |                    33 |                      0 |                  0 |                      0 |                  0 |                      0 |                  0 |
| SQUARE_TORUS        |               189 |                   315 |                      0 |                  0 |                      0 |                  0 |                      0 |                  0 |
| Double Step         |                 0 |                     0 |                     58 |                 44 |                    116 |                 88 |                    174 |                132 |
| Double-and-Add Step |                 0 |                     0 |                      4 |                 21 |                      8 |                 42 |                     12 |                 63 |
| Triple Step         |                 0 |                     0 |                      1 |                  0 |                      2 |                  0 |                      3 |                  0 |
| MUL_L_BY_L          |                 0 |                     0 |                      5 |                 22 |                     68 |                 88 |                     73 |                110 |
| MUL_LL_BY_LL        |                 0 |                     0 |                      0 |                  0 |                      5 |                 22 |                      5 |                 23 |
| MUL_LL_BY_L         |                 0 |                     0 |                      0 |                  0 |                      0 |                  0 |                     58 |                 44 |
| MUL_BY_L            |                 0 |                     0 |                     58 |                 44 |                      0 |                  0 |                      0 |                  0 |
| MUL_BY_LL           |                 0 |                     0 |                      5 |                 22 |                     58 |                 44 |                      5 |                 21 |



## Support & How to Contribute

We warmly welcome contributions and support from the community! Here's how you can help Garaga grow and improve:

### Reporting Issues & Requesting Features

- **Spot a bug? Have a feature request?** Check out our [issues page](https://github.com/keep-starknet-strange/garaga/issues) to see if it's already been reported or to open a new issue.

### Contributing to Garaga

- **Interested in contributing?** Please take a moment to read our [contribution guidelines](docs/CONTRIBUTING.md) for details on how to get started. Your contributions make the open-source community an incredible place for learning, inspiration, and creation.

### Showing Support

- **Love Garaga?** Give us a [star on GitHub](https://github.com/keep-starknet-strange/garaga) to show your support.
- **Spread the word:** Share your excitement about Garaga on social platforms like Twitter, [Dev.to](https://dev.to/), [Medium](https://medium.com/), or your personal blog.
- **Join the conversation:** Connect with us and other Garaga enthusiasts on our [Telegram group](https://t.me/GaragaPairingCairo).

Every contribution, whether it's code, feedback, or spreading the word, greatly benefits everyone and is deeply appreciated. Thank you for being a part of Garaga's journey!


## Security

Garaga follows good practices of security, but 100% security cannot be assured.
Garaga is provided **"as is"** without any **warranty**. Use at your own risk.

_For more information and to report security issues, please refer to our
[security documentation](docs/SECURITY.md)._

## License

This project is licensed under the **MIT license**.

See [LICENSE](LICENSE) for more information.

## Acknowledgements

- Huge props to [tekkac](https://github.com/tekkac) and [feltroidprime](https://github.com/feltroidprime) for their initial work on provable pairing-based cryptography in StarkNet.
- Credits to [Nethermind](https://github.com/NethermindEth/) for their [initial work on optimized modular arithmetic](https://github.com/NethermindEth/research-basic-Cairo-operations-big-integers/tree/main/lib).
- [Herodotus](https://www.herodotus.dev/) for supporting this project.
- [Gnark project](https://github.com/ConsenSys/gnark-crypto) and team, especially [yelhousni](https://github.com/yelhousni) for his amazing knowledge and support.
- [OnlyDust](https://www.onlydust.xyz/) and [Starkware](https://starkware.co/). 
- Liam Eagen and Andrija Novakovic for their support and amazing research.
## Resources
- Craig Costello, [Pairing for beginners](https://static1.squarespace.com/static/5fdbb09f31d71c1227082339/t/5ff394720493bd28278889c6/1609798774687/PairingsForBeginners.pdf)
- Y. El Housni, "Pairings in Rank-1 Constraint Systems," Cryptology ePrint Archive, Report 2022/1162, 2022. Available: [https://eprint.iacr.org/2022/1162](https://eprint.iacr.org/2022/1162).
- feltroidprime. "Faster Extension Field multiplications for Emulated Pairing Circuits." HackMD, [https://hackmd.io/@feltroidprime/B1eyHHXNT](https://hackmd.io/@feltroidprime/B1eyHHXNT).
- Liam Eagen, "Zero Knowledge Proofs of Elliptic Curve Inner Products from Principal Divisors and Weil Reciprocity," Cryptology ePrint Archive, Report 2022/596, 2022. Available: [https://eprint.iacr.org/2022/596](https://eprint.iacr.org/2022/596)
- Andrija Novakovic and Liam Eagen, "On Proving Pairings," Cryptology ePrint Archive, Paper 2024/640, 2024. Available: [https://eprint.iacr.org/2024/640](https://eprint.iacr.org/2024/640)

> **Note:** This list is not exhaustive, and is not intended to be.


## Contributors
For a full list of all authors and contributors, see
[the contributors page](https://github.com/keep-starknet-strange/garaga/contributors).

Thanks goes to these wonderful people ([emoji key](https://allcontributors.org/docs/en/emoji-key)):

<!-- ALL-CONTRIBUTORS-LIST:START - Do not remove or modify this section -->
<!-- prettier-ignore-start -->
<!-- markdownlint-disable -->
<table>
  <tbody>
    <tr>
      <td align="center" valign="top" width="14.28%"><a href="https://github.com/feltroidprime"><img src="https://avatars.githubusercontent.com/u/96737978?v=4?s=100" width="100px;" alt="Feltroid Prime"/><br /><sub><b>Feltroid Prime</b></sub></a><br /><a href="https://github.com/keep-starknet-strange/garaga/commits?author=feltroidprime" title="Code">üíª</a></td>
      <td align="center" valign="top" width="14.28%"><a href="https://github.com/abdelhamidbakhta"><img src="https://avatars.githubusercontent.com/u/45264458?v=4?s=100" width="100px;" alt="Abdel @ StarkWare "/><br /><sub><b>Abdel @ StarkWare </b></sub></a><br /><a href="https://github.com/keep-starknet-strange/garaga/commits?author=abdelhamidbakhta" title="Code">üíª</a></td>
      <td align="center" valign="top" width="14.28%"><a href="https://github.com/tekkac"><img src="https://avatars.githubusercontent.com/u/98529704?v=4?s=100" width="100px;" alt="Tarik K."/><br /><sub><b>Tarik K.</b></sub></a><br /><a href="https://github.com/keep-starknet-strange/garaga/commits?author=tekkac" title="Code">üíª</a></td>
      <td align="center" valign="top" width="14.28%"><a href="https://github.com/bacharif"><img src="https://avatars.githubusercontent.com/u/22233193?v=4?s=100" width="100px;" alt="Bachir Arif"/><br /><sub><b>Bachir Arif</b></sub></a><br /><a href="https://github.com/keep-starknet-strange/garaga/commits?author=bacharif" title="Code">üíª</a></td>
      <td align="center" valign="top" width="14.28%"><a href="https://github.com/rdubois-crypto"><img src="https://avatars.githubusercontent.com/u/103030189?v=4?s=100" width="100px;" alt="Renaud Dubois"/><br /><sub><b>Renaud Dubois</b></sub></a><br /><a href="https://github.com/keep-starknet-strange/garaga/commits?author=rdubois-crypto" title="Code">üíª</a></td>
    </tr>
  </tbody>
  <tfoot>
    <tr>
      <td align="center" size="13px" colspan="7">
        <img src="https://raw.githubusercontent.com/all-contributors/all-contributors-cli/1b8533af435da9854653492b1327a23a4dbd0a10/assets/logo-small.svg">
          <a href="https://all-contributors.js.org/docs/en/bot/usage">Add your contributions</a>
        </img>
      </td>
    </tr>
  </tfoot>
</table>

<!-- markdownlint-restore -->
<!-- prettier-ignore-end -->

<!-- ALL-CONTRIBUTORS-LIST:END -->

This project follows the [all-contributors](https://github.com/all-contributors/all-contributors) specification. Contributions of any kind welcome!
